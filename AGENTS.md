# Repository Guidelines

## Project Structure & Module Organization
- `frontend/`: Create React App. Source in `src/` (`components/`, `pages/`, `hooks/`), tests in `src/__tests__/` or `*.test.tsx`, build output in `build/`.
- `backend/`: Cloudflare Worker (`worker.js`) and `wrangler.toml` (generated by scripts). Optional `schema.sql` for D1.
- `router/`, `worker/`: Reserved if splitting Worker concerns.
- `scripts/`: Deployment and maintenance scripts (`.sh` + `.ps1`).
- `.env.example`: Required/optional environment variables.

## Build, Test, and Development Commands
- Deploy (Linux/macOS): `export CLOUDFLARE_API_TOKEN=... CLOUDFLARE_ACCOUNT_ID=... CF_PAGES_PROJECT=... REACT_APP_API_ORIGIN=... && bash scripts/deploy_cloudflare.sh`.
- Deploy (Windows): Set env vars, then `powershell -ExecutionPolicy Bypass -File scripts/deploy_cloudflare.ps1`.
- Verify Cloudflare stack: `bash scripts/verify_stack.sh` (Wrangler version, D1 DBs, Pages projects).
- Local frontend: `cd frontend && npm install && npm start`.
- Local Worker: `cd backend && wrangler dev`.
- Seed D1: `bash scripts/seed_d1.sh` or `powershell -ExecutionPolicy Bypass -File scripts/seed_d1.ps1` (use `D1_LOCAL=1` for local SQLite).

## Coding Style & Naming Conventions
- Language: JS/TS with CRA defaults; Cloudflare Worker JS.
- Indentation: 2 spaces; prefer single quotes; consistent semicolons.
- Naming: Components `PascalCase` (e.g., `ImageGrid.tsx`); hooks/utilities `camelCase` (e.g., `useImages.ts`).
- Tools: Prettier + ESLint in `frontend/`. Format: `cd frontend && npx prettier --write "src/**/*.{js,jsx,ts,tsx,json,css,md}"`. Lint: `npx eslint "src/**/*.{js,jsx,ts,tsx}"`.

## Testing Guidelines
- Frameworks: Jest + React Testing Library for frontend.
- Scope: Smoke coverage for pages and critical utils; keep tests deterministic.
- Naming: `*.test.tsx` (or `*.test.ts`). Run: `cd frontend && npm test`.

## Commit & Pull Request Guidelines
- Commits: Conventional Commits (e.g., `feat: add image search grid`, `fix: handle empty D1 response`). Keep scope small and messages imperative.
- PRs: Include purpose, linked issue, screenshots for UI changes, and deployment notes (env vars, routes). Ensure scripts still run (deploy + verify).

## Security & Configuration Tips
- Never commit secrets. Copy `.env.example` to non-tracked local env files.
- Required env: `CLOUDFLARE_API_TOKEN`, `CLOUDFLARE_ACCOUNT_ID`, `CF_PAGES_PROJECT`, `REACT_APP_API_ORIGIN`.
- Optional: `CF_PAGES_DOMAIN`, `WORKER_ROUTE_PATTERN`, `D1_DB_NAME`, `R2_BUCKET`, `KV_NAMESPACE_ID`/`KV_PREVIEW_ID`, `ADMIN_TOKEN`.
- Admin token: When set, write endpoints require `Authorization: Bearer <token>`. Use `wrangler secret put ADMIN_TOKEN` in production.
- Dev convenience: `frontend/.env.development.local` with `REACT_APP_API_ORIGIN=http://127.0.0.1:8787` (and optional `REACT_APP_ADMIN_TOKEN`).
